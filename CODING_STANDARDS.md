# Coding Standards & Guidelines

> **Auto-generated by NSO init.** Customize for your project.

## 1. General Principles

- **Clarity over cleverness:** Code should be easy for both humans and LLMs to understand.
- **Validation first:** No code is written without a corresponding validation step (test, compile check, or lint).
- **Single responsibility:** Functions and classes should be small, single-purpose, and testable.
- **Fail fast:** Public functions must begin with assertions on their inputs.

## 2. Style Guide

<!-- NSO will populate the relevant section based on project type detection. -->
<!-- Delete sections that don't apply to your project. -->

### TypeScript / JavaScript

- **Strict mode:** `strict: true` in `tsconfig.json`.
- **Functional:** Prefer functional patterns (`map`/`filter`/`reduce`) over imperative loops.
- **Immutability:** Use `const` everywhere possible. Avoid mutation.
- **Async:** Always handle rejected promises. Never fire-and-forget.
- **Naming:** `camelCase` for variables/functions, `PascalCase` for components/classes/types, `SCREAMING_SNAKE` for constants.
- **Imports:** Group by: (1) external packages, (2) internal modules, (3) relative imports. Blank line between groups.

### Python

- **Typing:** Strict type hints (`mypy` strict mode recommended).
- **Docstrings:** Google-style docstrings for all public methods.
- **Error handling:** Use custom exceptions; avoid bare `try/except`.
- **Dependencies:** Managed via `uv`, `poetry`, or `pip` with pinned versions.

### CSS / Styling

- **Tokens:** Use CSS variables or design tokens — never hardcode hex values.
- **Utility-first:** Prefer Tailwind utility classes over custom CSS where available.
- **Responsive:** Mobile-first. Use container queries for component-level responsiveness.

## 3. Logging Standards (STRICT)

**FORBIDDEN:** Using `console.log()` directly in production code.

**REQUIRED:** Use the logging utility for all debug output:

```typescript
// ❌ WRONG - Production console pollution
console.log('User clicked button:', userId);

// ✅ CORRECT - Tree-shakeable development logging
import { createLogger } from './lib/logger';
const log = createLogger('ButtonComponent');
log.debug('User clicked button:', userId);
```

### 3.1 Required Patterns

**Development Logging:**
- Use `createLogger(namespace)` for all debug output
- Namespace should match file/component name
- Use semantic log levels: `debug`, `info`, `warn`, `error`

**Production Logging:**
- `console.error()` for actual errors (production-visible)
- `console.warn()` for actual warnings (production-visible)
- NEVER use `console.log()` for errors (not semantic)

**Tree-Shaking:**
- Logger MUST be tree-shakeable in production builds
- Verify with: `npm run build && ls -lh dist/assets/*.js`
- All `debug`/`info` calls MUST be eliminated at build time

### 3.2 ESLint Enforcement

```json
{
  "rules": {
    "no-console": ["error", { "allow": ["warn", "error"] }]
  }
}
```

This rule is REQUIRED in all packages. Violations MUST be caught in CI.

### 3.3 Observability (NSO Requirement)

Any code performing external I/O (Fetch, DB, API, File) MUST include explicit start/success/failure logging:

### 3.3 Observability (NSO Requirement)

Any code performing external I/O (Fetch, DB, API, File) MUST include explicit start/success/failure logging:

```typescript
const log = createLogger('DataFetcher');
log.debug(`FETCH_START: ${url}`);
try {
  const result = await fetch(url);
  log.debug(`FETCH_SUCCESS: ${url} (${result.status})`);
  return result;
} catch (error) {
  console.error(`FETCH_FAIL: ${url}`, error); // Use console.error for production errors
  throw error;
}
```

## 4. Testing Standards

- **TDD cycle:** Write failing test → implement → verify → refactor.
- **Naming:** Test names describe behavior: `it("returns empty array when no items match filter")`.
- **Coverage:** All public APIs must have tests. Internal helpers tested through their public consumers.
- **Isolation:** Tests must not depend on external services or global state.

## 5. Documentation

- **In-code:** JSDoc/docstrings for all public APIs.
- **Architecture decisions:** Significant changes get an ADR (Architectural Decision Record) in `docs/architecture/`.
- **Context updates:** Changes to tech stack or patterns must be reflected in `.opencode/context/`.

## 6. Git Conventions

- **Commits:** Concise, descriptive messages. Focus on "why" not "what".
- **Branches:** Feature branches via worktree for BUILD workflow.
- **No secrets:** Never commit API keys, tokens, or credentials.
