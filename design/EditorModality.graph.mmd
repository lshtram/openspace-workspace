flowchart TD
  subgraph User["User"]
    U1["Open file from tree"]
    U2["Edit content"]
    U3["Save file (Cmd/Ctrl+S)"]
    U4["Switch tabs"]
    U5["Toggle View/Edit mode"]
  end

  subgraph Client["OpenSpace Client"]
    F["EditorFrame"]
    T["EditorTabsBar + Mode Toggle"]
    ES["EditorSurface (single content area)"]
    B["Editor Buffer Manager"]
    M["MonacoEditorPane (edit mode)"]
    V["DocumentViewerPane (view mode)"]
    VR["ViewerRegistry"]
    MD["MarkdownViewer"]
    MM["MermaidBlockRenderer"]
    S["Status Bar (dirty/conflict/lang)"]
  end

  subgraph Domain["Editor Domain Layer"]
    D["useEditorDomain"]
    PTH["Path + Tab Canonicalizer"]
    TR["Tree Store"]
    CC["Content Cache"]
    VC["View Cache"]
    WI["Watcher Invalidator"]
  end

  subgraph Runtime["Runtime Hub"]
    H["/artifacts API"]
    E["/events (SSE)"]
    C["/context/active-editor-file"]
    A["ArtifactStore"]
  end

  subgraph OpenCode["OpenCode API"]
    R["file.read"]
  end

  subgraph FS["Filesystem"]
    P["Project files (*.ts, *.md, *.json, ...)"]
  end

  U1 --> F
  F --> D
  D --> PTH
  D --> TR
  D --> CC
  D --> VC
  D --> R
  R --> P
  D --> C
  F --> T
  F --> ES
  ES --> B

  U2 --> ES
  ES --> M
  M --> B
  B --> S

  U3 --> F
  F --> B
  B --> H
  H --> A
  A --> P

  U4 --> T
  T --> ES

  U5 --> T
  T --> ES
  ES --> V
  V --> VR
  VR --> MD
  MD --> MM

  A -->|FILE_CHANGED| E
  E --> D
  D --> WI
  WI --> B
  WI --> TR
